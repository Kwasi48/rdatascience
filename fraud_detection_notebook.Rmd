---
title: "Fraud Detection Using Machine Learning"
output:
  word_document: default
  html_notebook: default
  html_document:
    df_print: paged
  pdf_document: default
editor_options: 
  chunk_output_type: inline
---

------------------------------------------------------------------------

# "Fraud Detection Using Machine Learning

## Importing the data set into R and loading the required packages

```{r}
library(tidyverse)
library('randomForest')
library('caret')
library('e1071')

```

### A Synthetic Financial Transaction Data set was used for this work. This data set was imported from Kaggle. Sri Harsha Eedala created it.

**Note: This data has been truncated due to computational limitations**

```{r}
fraud_data <- read.csv("C:/Users/mike/Downloads/financial dataset/Synthetic_Financial_datasets_log.csv")
head(fraud_data)
tibble(fraud_data)

```

# Exploratory Data Analysis

# Getting a feel of the data.

### Total Transactions made by each type.

```{r}
#total transactions by type
total_trans <- fraud_data |>  group_by(type) |> summarise(total_transactions = sum(amount))
total_trans
ggplot( total_trans, aes(x= type, y=total_transactions)) + geom_col( mapping = aes( fill = type, ))  

 ggplot( total_trans, aes(x= type, y=total_transactions)) + geom_point( mapping = aes( size = total_transactions, color = type)) + labs(title = "Total Transactions by Each Type" ,y="total transactions", y = "type of transaction")
```

### Total transaction types that were fraudulent Only cash_out and transfer transactions were found to be usually fraudulent by operators.

```{r}
total_fraud <- fraud_data |>  group_by(type) |> summarise(total_transactions = sum(isFraud))
total_fraud
ggplot(total_fraud, aes( x=type, y=total_transactions)) + geom_col( mapping = aes(fill=type), width = 1) + labs(title = "Number of Fraudulent transactions by Type", x="Type of Transaction",  y="Number of transactions")

```

### Frequency of Transactions made according to types. It could be noted that cash out was the most performed transaction while debit was the least performed.

```{r}
ggplot(fraud_data, aes(x=type, )) + geom_bar( mapping = aes(fill = type)) + labs( x= 'Type of Transactions', y = 'Number of Transactions' , title = 'Frequency of Transaction Types')

 
```

# Modelling the data for Prediction

## Support Vector Machine (SVM)

### For fraud detection, the author mandated the non-utilization of columns named oldbalancedOrg, newbalanceOrg, oldbalanceDest, and newbalanceDest.

```{r}
fraud_data <- fraud_data |> select(type, isFraud, amount)
#fraud_data <- fraud_data |> select(!newbalanceOrig)
#fraud_data <- fraud_data |> select(!oldbalanceDest)
#fraud_data <- fraud_data |> select(!newbalanceDest )
head(fraud_data)
```

### Setting the seed number and splitting the data into test and training set

```{r}
#setting the seed number
set.seed(100)

fraud_data$isFraud = factor(fraud_data$isFraud, levels = c(0,1))
#Splitting the dataset into the Training set and Test set 
library(caTools) 

split = sample.split(fraud_data$isFraud, SplitRatio = 0.5) 

training_set = subset(fraud_data, split == TRUE) 
test_set = subset(fraud_data, split == FALSE) 

```

### Fitting Support Vector Machine to the training set

```{r}
classifier = svm(formula = isFraud ~ amount, 
                 data = training_set, 
                 type = 'C-classification', 
                 kernel = 'linear') 
classifier
```

### Predicting Test Set Results

```{r}
model.prediction <- predict(classifier, newdata = test_set)
model.prediction
```

### Making the Confusion Matrix

```{r}
confusion_matrix <- caret::confusionMatrix(model.prediction, test_set$isFraud,)
confusion_matrix
```

### Explanation for SVM

### Recall

```{r}
Recall_svm <- caret::recall(model.prediction, test_set$isFraud)
Recall_svm
```

### Precision

```{r}
preci <- caret::precision(model.prediction, test_set$isFraud)
preci
```

### F1 Score

```{r}
f1_score <- ModelMetrics::f1Score(test_set$isFraud, model.prediction,  cutoff = 0.5)
f1_score
```

```{r}
fraud_data <- read.csv("C:/Users/mike/Downloads/financial dataset/Synthetic_Financial_datasets_log.csv")
fraud_analysis <- fraud_data %>%  select( isFraud, amount)
fraud_analysis
```

## Logistic Regression Model

```{r}
library("ROCR")
#Splitting the data set 
data_split <- sample.split(fraud_analysis, SplitRatio = 0.5)
#data_split

set.train <- subset(fraud_analysis, split== "TRUE")
set.test <- subset(fraud_analysis, split== "FALSE")

# modelling
logistic_model <- glm(isFraud ~ amount, data = set.train, family = binomial(link = "logit"))
 
summary(logistic_model)

```

```{r}
pscl::pR2(logistic_model)["McFadden"]
```

### model have a lower McFadden R2 score indicating the model having low predictive power.

### plotting the logistic regression graph

```{r}
#par(mar=c(4, 4, 1, 1)) 
#3plot(fraud_analysis$amount, fraud_analysis$isFraud)
#curve(predict(logistic_model, data.frame(amount=x), type="response"), add=TRUE) 

ggplot(set.train ,aes(x=amount, y=isFraud)) + geom_jitter(height = .05, alpha=.1) + geom_smooth(method = "glm", method.args = list(family= "binomial"), se=FALSE)

```

```{r}
predict.result <- predict(logistic_model, set.test, type = "response")
predict.result <- ifelse(predict.result > 0.5, 1, 0)

misClassError <- mean(predict.result != fraud_analysis$isFraud)
print(paste("Accuracy",1-misClassError))
 
```

```{r}
 
pred.result <- predict(logistic_model, set.test, type = "response")
pre.result <- prediction(pred.result, set.test$isFraud)
perf <- performance(pre.result, measure = "tpr", x.measure = 'fpr')
plot(perf)
```

```{r}
auc <- performance(pre.result, measure = "auc")
auc <- auc@y.values[[1]]
auc
```

## Random Forest Model

```{r}
 
library('randomForest')

fraud_data$isFraud = factor(fraud_data$isFraud, levels = c(0,1))

#splitting the data 
splitz <- sample.split(fraud_data, SplitRatio = 0.5)

#.....into test and train set
settrain <- subset(fraud_data, splitz == "TRUE")
settest <- subset(fraud_data, splitz == "FALSE")
```

```{r}
#Fitting Random Forest to the train set
set.seed(100)
head(settrain[-1])
model.ran <- randomForest(x = settrain[-1], y = settrain$isFraud, ntree = 500)
model.ran

```

### Predicting the test set result

```{r}
pred_test <- predict(model.ran, newdata = settest[-1])
pred_test
```

```{r}
confusion_matrix <- caret::confusionMatrix(settest$isFraud, pred_test)
confusion_matrix
```
